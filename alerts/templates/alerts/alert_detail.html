{% extends "alerts/base.html" %}
{% block extra_css %}
<style>
/* Custom styles for alert details page */
.alert-header {
    border-left: 5px solid #dc3545;
    padding-left: 15px;
}

.alert-header.severity-critical {
    border-left-color: #dc3545;
}

.alert-header.severity-warning {
    border-left-color: #ffc107;
}

.alert-header.severity-info {
    border-left-color: #0dcaf0;
}

.tab-content {
    padding: 20px;
    border-left: 1px solid #dee2e6;
    border-right: 1px solid #dee2e6;
    border-bottom: 1px solid #dee2e6;
    border-radius: 0 0 0.25rem 0.25rem;
}

.nav-tabs .nav-link.active {
    font-weight: 500;
}

.badge {
    font-size: 0.85em;
}

.ongoing-duration {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.6; }
    100% { opacity: 1; }
}

/* Documentation content styles */
.documentation-content {
    direction: rtl;
    text-align: right;
}

.documentation-content p {
    direction: rtl;
    text-align: right;
}

.documentation-content p:has(code),
.documentation-content pre,
.documentation-content code {
    direction: ltr;
    text-align: left;
    font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
}

.documentation-content img {
    max-width: 100%;
    height: auto;
}

.documentation-content table {
    width: 100%;
    margin-bottom: 1rem;
    border-collapse: collapse;
}

.documentation-content table th,
.documentation-content table td {
    padding: 0.75rem;
    border: 1px solid #dee2e6;
}

.documentation-content table th {
    background-color: #f8f9fa;
}

.documentation-content pre {
    background-color: #f8f9fa;
    padding: 1rem;
    border-radius: 0.25rem;
    overflow-x: auto;
    direction: ltr;
    text-align: left;
}

.documentation-content blockquote {
    border-right: 4px solid #dee2e6;
    padding-right: 1rem;
    margin: 1rem 0;
    color: #6c757d;
}

.documentation-section {
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 5px;
    background-color: #f8f9fa;
}
</style>
{% endblock %}

{% block title %}{{ alert.name }} - SentryHub{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'alerts:dashboard' %}">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="{% url 'alerts:alert-list' %}">Alerts</a></li>
                <li class="breadcrumb-item active">{{ alert.name }}</li>
            </ol>
        </nav>
    </div>
</div>

<!-- Alert Summary Card -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <h4 class="alert-header severity-{{ alert.severity }}">{{ alert.name }} 
                        {% if alert.current_status == 'firing' %}
                        <span class="badge bg-danger">Firing</span>
                        {% else %}
                        <span class="badge bg-success">Resolved</span>
                        {% endif %}
                    </h4>
                    <div>
                        {% if not alert.acknowledged %}
                        <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#acknowledgeModal">
                            <i class="bi bi-check-circle"></i> Acknowledge
                        </button>
                        
                        <!-- Acknowledge Modal -->
                        <div class="modal fade" id="acknowledgeModal" tabindex="-1" aria-labelledby="acknowledgeModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="acknowledgeModalLabel">Acknowledge Alert</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <form method="post">
                                        <div class="modal-body">
                                            {% csrf_token %}
                                            <p>You are acknowledging the alert: <strong>{{ alert.name }}</strong></p>
                                            <p>Please provide a comment explaining the reason for acknowledgement or any actions being taken:</p>
                                            
                                            <div class="mb-3">
                                                <label for="id_comment" class="form-label">Comment <span class="text-danger">*</span></label>
                                                {{ acknowledge_form.comment }}
                                                <div class="form-text">Required: Please provide details about why you're acknowledging this alert.</div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                            <button type="submit" name="acknowledge" class="btn btn-primary">Acknowledge Alert</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-6">
                        <table class="table">
                            <tr>
                                <th style="width: 30%">Status</th>
                                <td>
                                    {% if alert.current_status == 'firing' %}
                                    <span class="badge bg-danger">Firing</span>
                                    {% else %}
                                    <span class="badge bg-success">Resolved</span>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <th>Severity</th>
                                <td>
                                    {% if alert.severity == 'critical' %}
                                    <span class="badge bg-danger">Critical</span>
                                    {% elif alert.severity == 'warning' %}
                                    <span class="badge bg-warning text-dark">Warning</span>
                                    {% else %}
                                    <span class="badge bg-info text-dark">Info</span>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <th>First Occurrence</th>
                                <td>{{ alert.first_occurrence|date:"Y-m-d H:i:s" }}</td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <table class="table">
                            <tr>
                                <th style="width: 30%">Last Occurrence</th>
                                <td>{{ alert.last_occurrence|date:"Y-m-d H:i:s" }}</td>
                            </tr>
                            <tr>
                                <th>Total Firing Count</th>
                                <td>{{ alert.total_firing_count }}</td>
                            </tr>
                            <tr>
                                <th>Acknowledged</th>
                                <td>
                                    {% if alert.acknowledged %}
                                    Yes, by {{ alert.acknowledged_by.username }} at {{ alert.acknowledgement_time|date:"Y-m-d H:i:s" }}
                                    {% else %}
                                    <span class="badge bg-secondary">No</span>
                                    {% endif %}
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tabs Navigation -->
<ul class="nav nav-tabs" id="alertTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link {% if active_tab == 'details' %}active{% endif %}" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button" role="tab" aria-controls="details" aria-selected="{% if active_tab == 'details' %}true{% else %}false{% endif %}">
            <i class="bi bi-info-circle"></i> Alert Details
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link {% if active_tab == 'history' %}active{% endif %}" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab" aria-controls="history" aria-selected="{% if active_tab == 'history' %}true{% else %}false{% endif %}">
            <i class="bi bi-clock-history"></i> History
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link {% if active_tab == 'docs' %}active{% endif %}" id="docs-tab" data-bs-toggle="tab" data-bs-target="#docs" type="button" role="tab" aria-controls="docs" aria-selected="{% if active_tab == 'docs' %}true{% else %}false{% endif %}">
            <i class="bi bi-book"></i> Documentation
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link {% if active_tab == 'comments' %}active{% endif %}" id="comments-tab" data-bs-toggle="tab" data-bs-target="#comments" type="button" role="tab" aria-controls="comments" aria-selected="{% if active_tab == 'comments' %}true{% else %}false{% endif %}">
            <i class="bi bi-chat-dots"></i> Comments 
            <span class="badge bg-secondary rounded-pill">{{ comments.count }}</span>
        </button>
    </li>
</ul>

<!-- Tab Content -->
<div class="tab-content" id="alertTabsContent">
    <!-- Alert Details Tab -->
    <div class="tab-pane fade {% if active_tab == 'details' %}show active{% endif %}" id="details" role="tabpanel" aria-labelledby="details-tab">
        <div class="row">
            <div class="col-md-6">
                <h5 class="border-bottom pb-2 mb-3">Labels</h5>
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Key</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for key, value in alert.labels.items %}
                        <tr>
                            <td><code>{{ key }}</code></td>
                            <td><code>{{ value }}</code></td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="2" class="text-center">No labels</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="col-md-6">
                <h5 class="border-bottom pb-2 mb-3">Latest Annotations</h5>
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Key</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% with last_instance=instances.first %}
                        {% if last_instance %}
                            {% for key, value in last_instance.annotations.items %}
                            <tr>
                                <td><code>{{ key }}</code></td>
                                <td>{{ value }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="2" class="text-center">No annotations</td>
                            </tr>
                            {% endfor %}
                        {% else %}
                        <tr>
                            <td colspan="2" class="text-center">No instances</td>
                        </tr>
                        {% endif %}
                        {% endwith %}
                    </tbody>
                </table>

                <h5 class="border-bottom pb-2 mb-3 mt-4">Additional Details</h5>
                <table class="table table-sm">
                    <tr>
                        <th>Fingerprint</th>
                        <td><code>{{ alert.fingerprint }}</code></td>
                    </tr>
                    {% with last_instance=instances.first %}
                    {% if last_instance and last_instance.generator_url %}
                    <tr>
                        <th>Source</th>
                        <td>
                            <a href="{{ last_instance.generator_url }}" target="_blank" class="btn btn-sm btn-outline-secondary">
                                <i class="bi bi-box-arrow-up-right"></i> View in Prometheus
                            </a>
                        </td>
                    </tr>
                    {% endif %}
                    {% endwith %}
                </table>
            </div>
        </div>
    </div>
    
    <!-- History Tab -->
    <div class="tab-pane fade {% if active_tab == 'history' %}show active{% endif %}" id="history" role="tabpanel" aria-labelledby="history-tab">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">Alert History</h5>
        </div>
        
        <div class="table-responsive">
            <table class="table table-bordered table-hover">
                <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>Status</th>
                        <th>Started</th>
                        <th>Resolved</th>
                        <th>Duration</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for instance in instances %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>
                            {% if instance.status == 'firing' and not instance.ended_at %}
                            <span class="badge bg-danger">Firing</span>
                            {% else %}
                            <span class="badge bg-success">Resolved</span>
                            {% endif %}
                        </td>
                        <td>{{ instance.started_at|date:"Y-m-d H:i:s" }}</td>
                        <td>
                            {% if instance.ended_at %}
                                {{ instance.ended_at|date:"Y-m-d H:i:s" }}
                            {% elif instance.status == 'resolved' and instance.resolution_type == 'inferred' %}
                                <span class="badge bg-warning text-dark">Inferred Resolution</span>
                            {% elif instance.status == 'firing' and not instance.ended_at %}
                                <span class="badge bg-warning text-dark">Not Resolved Yet</span>
                            {% else %}
                                <span class="badge bg-secondary">Unknown</span>
                            {% endif %}
                        </td>
                        <td>
                            <span class="{% if instance.status == 'firing' and not instance.ended_at %}text-warning fw-bold{% endif %}">
                                {% if instance.ended_at %}
                                <span class="duration" data-start="{{ instance.started_at|date:'c' }}" data-end="{{ instance.ended_at|date:'c' }}">
                                    Calculating...
                                </span>
                                {% elif instance.status == 'firing' and not instance.ended_at %}
                                <span class="ongoing-duration" data-start="{{ instance.started_at|date:'c' }}">
                                    Ongoing
                                </span>
                                {% else %}
                                --
                                {% endif %}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-outline-info" data-bs-toggle="modal" data-bs-target="#instanceModal{{ instance.id }}">
                                <i class="bi bi-info-circle"></i> Details
                            </button>
                            
                            {% if instance.generator_url %}
                            <a href="{{ instance.generator_url }}" target="_blank" class="btn btn-sm btn-outline-secondary">
                                <i class="bi bi-box-arrow-up-right"></i> Prometheus
                            </a>
                            {% endif %}
                            
                            <!-- Modal for instance details -->
                            <div class="modal fade" id="instanceModal{{ instance.id }}" tabindex="-1" aria-labelledby="instanceModalLabel{{ instance.id }}" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="instanceModalLabel{{ instance.id }}">Alert Instance Details</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <h6>Annotations</h6>
                                            <table class="table table-sm">
                                                <thead>
                                                    <tr>
                                                        <th>Key</th>
                                                        <th>Value</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for key, value in instance.annotations.items %}
                                                    <tr>
                                                        <td><code>{{ key }}</code></td>
                                                        <td>{{ value }}</td>
                                                    </tr>
                                                    {% empty %}
                                                    <tr>
                                                        <td colspan="2" class="text-center">No annotations</td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center">No history available</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            <!-- Pagination -->
            {% if instances.paginator.num_pages > 1 %}
            <nav aria-label="History pagination" class="mt-4">
                <ul class="pagination justify-content-center">
                    {% if instances.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ instances.previous_page_number }}&tab=history" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                    {% endif %}
                    
                    {% for num in instances.paginator.page_range %}
                        {% if instances.number == num %}
                        <li class="page-item active">
                            <span class="page-link">{{ num }}</span>
                        </li>
                        {% elif num > instances.number|add:'-3' and num < instances.number|add:'3' %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ num }}&tab=history">{{ num }}</a>
                        </li>
                        {% endif %}
                    {% endfor %}
                    
                    {% if instances.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ instances.next_page_number }}&tab=history" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}
        </div>
    </div>
    
    <!-- Documentation Tab -->
    <div class="tab-pane fade {% if active_tab == 'docs' %}show active{% endif %}" id="docs" role="tabpanel" aria-labelledby="docs-tab">
        <div class="row">
            <div class="col-12">
                {% if linked_documentation %}
                    {% for link in linked_documentation %}
                    <div class="documentation-section">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5><i class="bi bi-book"></i> {{ link.documentation.title }}</h5>
                            <div>
                                <a href="{% url 'docs:documentation-detail' link.documentation.pk %}" class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-eye"></i> View Full
                                </a>
                                {% if perms.docs.change_alertdocumentation %}
                                <a href="{% url 'docs:documentation-update' link.documentation.pk %}" class="btn btn-sm btn-outline-secondary">
                                    <i class="bi bi-pencil"></i> Edit
                                </a>
                                {% endif %}
                            </div>
                        </div>
                        <div class="documentation-content">
                            {{ link.documentation.description|safe }}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i> No documentation linked to this alert.
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Comments Tab -->
    <div class="tab-pane fade {% if active_tab == 'comments' %}show active{% endif %}" id="comments" role="tabpanel" aria-labelledby="comments-tab">
        <!-- Comment Form -->
        <form method="post" class="mb-4" id="commentForm">
            {% csrf_token %}
            <div class="mb-3">
                <label for="id_content" class="form-label">Add a Comment</label>
                {{ comment_form.content }}
            </div>
            <button type="submit" name="comment" class="btn btn-primary">Submit</button>
        </form>

        <script>
        // Function to detect Persian text
        function isPersianText(text) {
            // Persian Unicode range: \u0600-\u06FF
            const persianRegex = /[\u0600-\u06FF]/;
            return persianRegex.test(text);
        }

        // Function to set text direction based on content
        function setTextDirection(element) {
            if (isPersianText(element.textContent)) {
                element.style.direction = 'rtl';
                element.style.textAlign = 'right';
            } else {
                element.style.direction = 'ltr';
                element.style.textAlign = 'left';
            }
        }

        // Function to handle input direction
        function handleInputDirection(event) {
            const textarea = event.target;
            if (isPersianText(textarea.value)) {
                textarea.style.direction = 'rtl';
                textarea.style.textAlign = 'right';
            } else {
                textarea.style.direction = 'ltr';
                textarea.style.textAlign = 'left';
            }
        }

        // Apply RTL detection to existing comments
        document.addEventListener('DOMContentLoaded', function() {
            const commentTexts = document.querySelectorAll('.card-text');
            commentTexts.forEach(setTextDirection);

            // Add input event listener to comment textarea
            const commentTextarea = document.querySelector('#id_content');
            if (commentTextarea) {
                commentTextarea.addEventListener('input', handleInputDirection);
                // Set initial direction
                handleInputDirection({ target: commentTextarea });
            }
        });

        // Modify the comment form submission to handle RTL
        document.getElementById('commentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            formData.append('comment', 'true');
            
            fetch(window.location.href, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // Show success message
                    toastr.success("Comment added successfully.");
                    
                    // Clear the form
                    this.reset();
                    
                    // Add the new comment to the list
                    const commentsContainer = document.querySelector('.comments');
                    const newComment = document.createElement('div');
                    newComment.className = 'card mb-3';
                    newComment.innerHTML = `
                        <div class="card-header bg-light">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <strong>${data.user}</strong>
                                </div>
                                <div>
                                    <small class="text-muted">${new Date().toLocaleString()}</small>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <p class="card-text">${data.content}</p>
                        </div>
                    `;
                    
                    // Insert at the beginning of the comments list
                    if (commentsContainer.firstChild) {
                        commentsContainer.insertBefore(newComment, commentsContainer.firstChild);
                    } else {
                        commentsContainer.appendChild(newComment);
                    }
                    
                    // Apply RTL detection to the new comment
                    const newCommentText = newComment.querySelector('.card-text');
                    setTextDirection(newCommentText);
                    
                    // Remove the "No comments" message if it exists
                    const noCommentsAlert = commentsContainer.querySelector('.alert-info');
                    if (noCommentsAlert) {
                        noCommentsAlert.remove();
                    }
                    
                    // Update the comment count
                    const commentCount = document.querySelector('#comments-tab .badge');
                    if (commentCount) {
                        const currentCount = parseInt(commentCount.textContent);
                        commentCount.textContent = (currentCount + 1).toString();
                    }
                } else {
                    toastr.error("Error adding comment.");
                }
            })
            .catch(error => {
                console.error('Error:', error);
                toastr.error("Error adding comment.");
            });
        });
        </script>
        
        <!-- Comment List -->
        <div class="comments">
            {% for comment in comments %}
            <div class="card mb-3">
                <div class="card-header bg-light">
                    <div class="d-flex justify-content-between">
                        <div>
                            <strong>{{ comment.user.username }}</strong>
                        </div>
                        <div>
                            <small class="text-muted">{{ comment.created_at|date:"Y-m-d H:i:s" }}</small>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <p class="card-text">{{ comment.content }}</p>
                </div>
            </div>
            {% empty %}
            <div class="alert alert-info">
                No comments yet. Be the first to comment!
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Function to format duration
    function formatDuration(seconds) {
        if (seconds < 60) {
            return seconds + " seconds";
        } else if (seconds < 3600) {
            return Math.floor(seconds / 60) + " min " + (seconds % 60) + " sec";
        } else if (seconds < 86400) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            return hours + " hr " + minutes + " min";
        } else {
            const days = Math.floor(seconds / 86400);
            const hours = Math.floor((seconds % 86400) / 3600);
            return days + " days " + hours + " hr";
        }
    }

    // Calculate durations for completed periods
    document.querySelectorAll('.duration').forEach(function(el) {
        const start = new Date(el.dataset.start);
        const end = new Date(el.dataset.end);
        const duration = Math.floor((end - start) / 1000); // Duration in seconds
        el.textContent = formatDuration(duration);
    });
    
    // Calculate ongoing durations
    document.querySelectorAll('.ongoing-duration').forEach(function(el) {
        const start = new Date(el.dataset.start);
        const now = new Date();
        const duration = Math.floor((now - start) / 1000); // Duration in seconds
        el.textContent = formatDuration(duration) + " (ongoing)";
        
        // Update ongoing duration every minute
        setInterval(function() {
            const currentDuration = Math.floor((new Date() - start) / 1000);
            el.textContent = formatDuration(currentDuration) + " (ongoing)";
        }, 60000);
    });
    
    // Store active tab in URL when changed
    const tabLinks = document.querySelectorAll('#alertTabs button');
    tabLinks.forEach(tab => {
        tab.addEventListener('shown.bs.tab', function (e) {
            const tabId = e.target.getAttribute('data-bs-target').substring(1);
            const currentUrl = new URL(window.location.href);
            currentUrl.searchParams.set('tab', tabId);
            window.history.pushState({}, '', currentUrl);
        });
    });

    // Check for tab parameter in URL on page load
    const urlParams = new URLSearchParams(window.location.search);
    const tabParam = urlParams.get('tab');
    if (tabParam) {
        const tab = document.querySelector(`button[data-bs-target="#${tabParam}"]`);
        if (tab) {
            tab.click();
        }
    }
});
</script>
{% endblock %}